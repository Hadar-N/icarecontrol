{% extends "base.html" %}
{% block body %}

<div class="fulldisplay centered center-top">

    <div id="for-table"></div>

    <div id="for-instructions"></div>

</div>

<div class="ctrl-buttons">
    {% for btn in ["home","return"] %}
    <input type="radio" name="ctrl-buttons" id="{{btn}}" value="{{btn}}" />
    <label for="{{btn}}" class="ctrl-singlebutton" id="{{btn}}" onclick="onClickControl(this)">
        <img class="ctrl-img" src="/static/icons/{{btn}}.svg" alt="{{btn}}" />
    </label>
    {% endfor %}
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        for_table_elm = document.getElementById('for-table');
        word_table = new WordTable(for_table_elm);

        for_instructions_elm = document.getElementById('for-instructions');
        instructions_line = new InstructionsLine(for_instructions_elm);

        strings = GameState.getStrings()["gameprocess.html"]
        data_actions = GameState.getConsts().MQTT_DATA_ACTIONS
        active_contours = 0;

        instructions_line.applyInsructions(0)

        onClickControl = (obj) => {
            GameState.playClickAudio();
            clickControlFunc("stop");
            GameState.setCurrLevel(0)
            if (obj.getAttribute("id") == "home") {
                GameState.setCurrMode(0)
            }
            window.location.href = '/game/';
        }

        try {
            socket.on('word', data => {
                switch (data.type) {
                    case data_actions.NEW:
                        word_table.displayTable(data.word); // TODO : what happend if 2 contours at once?
                        break;
                    case data_actions.REMOVE:
                        word_table.turnoffTable();
                        instructions_line.applyInsructions(4);
                        break;
                    case data_actions.STATUS:
                        word_table.rerenderOptions(data.word);
                        instructions_line.applyInsructions(2);
                        break;
                    case data_actions.MATCHED:
                        word_table.matchedWord();
                        instructions_line.applyInsructions(3);
                        break;
                    case data_actions.SELECT_FAIL:
                        speakWord(strings.instructions.dig_2)
                        break;
                    default:
                        printInPythonTerminal('action type unaccepted:' + data.type)
                }
            });
            socket.on("contours", data => {
                if (data.contours == 0) {
                    word_table.turnoffTable();
                    instructions_line.applyInsructions(0);
                } else if ((data.contours > active_contours || data.contours >= 2) && word_table.isOptionsDisplayable()) {
                    word_table.displayOptions();
                    instructions_line.applyInsructions(1);
                }
                active_contours = data.contours
            })
        } catch (err) {
            console.log("word change err: ", err)
        }
    });
</script>

{% endblock %}